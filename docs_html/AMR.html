

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>AMR &mdash; IAMR 21.08-dev documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"macros": {"Ab": "{{\\bf A}}", "eb": "{{\\bf e}}", "Fb": "{{\\bf F}}", "gb": "{{\\bf g}}", "Hb": "{{\\bf H}}", "ib": "{{\\bf i}}", "Ib": "{{\\bf I}}", "Kb": "{{\\bf K}}", "lb": "{{\\bf l}}", "Lb": "{{\\bf L}}", "nb": "{{\\bf n}}", "Pb": "{{\\bf P}}", "Qb": "{{\\bf Q}}", "rb": "{{\\bf r}}", "Rb": "{{\\bf R}}", "Sb": "{{\\bf S}}", "ub": "{{\\bf u}}", "Ub": "{{\\bf U}}", "xb": "{{\\bf x}}", "dt": "{\\Delta t}", "omegadot": "{\\dot\\omega}", "inp": "{{\\rm in}}", "outp": "{{\\rm out}}", "sync": "{{\\rm sync}}", "half": "{\\frac{1}{2}}", "myhalf": "{\\half}", "nph": "{{n+\\myhalf}}", "vb": "{\\boldsymbol{v}}", "vbt": "{\\widetilde{\\vb}}", "rbt": "{\\widetilde{\\rb}}", "ob": "{\\boldsymbol{\\omega}}", "nablab": "{\\boldsymbol{\\nabla}}", "avg": ["{{\\left \\langle #1 \\right \\rangle}}", 1]}}}</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Parallelization" href="Parallel.html" />
    <link rel="prev" title="Gridding and Load Balancing" href="ManagingGridHierarchy_Chapter.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> IAMR
          

          
          </a>

          
            
            
              <div class="version">
                21.08-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction_Chapter.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting_Started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="Software_Chapter.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Visualization_Chapter.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inputs_Chapter.html">Run-time Inputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="ManagingGridHierarchy_Chapter.html">Gridding and Load Balancing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">AMR</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tagging-for-refinement">Tagging for Refinement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dynamically-generated-tagging-functions">Dynamically generated tagging functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#explicitly-defined-tagging-functions">Explicitly defined tagging functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Parallel.html">Parallelization</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fluids_Chapter.html">Solving the Fluid Equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="EB.html">Embedded Boundaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="Particles_Chapter.html">Particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Debugging.html">Debugging</a></li>
</ul>
<p class="caption"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">IAMR</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>AMR</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/AMR.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="amr">
<span id="chap-amr"></span><h1>AMR<a class="headerlink" href="#amr" title="Permalink to this headline">¶</a></h1>
<p>Our approach to adaptive refinement in IAMR uses a nested
hierarchy of logically-rectangular grids with simultaneous refinement
of the grids in both space and time. The integration algorithm on the grid hierarchy
is a recursive procedure in which coarse grids are advanced in time,
fine grids are advanced multiple steps to reach the same time
as the coarse grids and the data at different levels are then synchronized.</p>
<p>During the regridding step, increasingly finer grids
are recursively embedded in coarse grids until the solution is
sufficiently resolved. An error estimation procedure based on
user-specified criteria (described in <a class="reference internal" href="#tagging-for-refinement"><span class="std std-ref">Tagging for Refinement</span></a>)
evaluates where additional refinement is needed
and grid generation procedures dynamically create or
remove rectangular fine grid patches as resolution requirements change.</p>
<p>The dynamic creation and destruction of grid levels is a fundamental part of IAMR’s capabilities.
At regular intervals (set by the user), each Amr level that is not the finest allowed for the run
will invoke a “regrid” operation. When invoked, a set of error tagging functions is traversed. For each,
a field specific to that function is derived from the state over the level, and passed through a kernel
that “set”’s or “clear”’s a flag on each cell.
The field and function for each error tagging quantity is
identified in the setup phase of the code (in NS_error.cpp).
Each function adds or removes to the list of cells tagged for refinement.
This may then be extended if amr.n_error_buf <span class="math notranslate nohighlight">\(&gt; 0\)</span> to a certain number
of cells beyond these tagged cells.
This final list of tagged
cells is sent to a grid generation routine, which uses the Berger-Rigoutsos algorithm to create rectangular grids
which will define a new finer level (or set of levels). State data is filled over these new grids, copying where
possible, and interpolating from coarser level when no fine data is available. Once this process is complete,
the existing Amr level(s) is removed, the new one is inserted into the hierarchy, and the time integration
continues.</p>
<section id="tagging-for-refinement">
<h2>Tagging for Refinement<a class="headerlink" href="#tagging-for-refinement" title="Permalink to this headline">¶</a></h2>
<p>This section describes the process
by which cells are tagged during regridding, and describes how to add customized tagging criteria.
IAMR provides two methods for creating error estimation functions: dynamic generation and explicit or
hard-coded. First dynamic generation is discussed, followed by how to explicitly define error functions.</p>
<section id="dynamically-generated-tagging-functions">
<h3>Dynamically generated tagging functions<a class="headerlink" href="#dynamically-generated-tagging-functions" title="Permalink to this headline">¶</a></h3>
<p>Dynamically created error functions are based on runtime data specified in the
inputs (ParmParse) data.
These dynamically generated error functions can tag a specified region of the domain and/or test on a field
that is a state variable
or derived variable defined in NS_derive.cpp and included in the derive_lst in NS_setup.cpp.
Available tests include</p>
<ul class="simple">
<li><p>“greater_than”: <span class="math notranslate nohighlight">\(field &gt;= threshold\)</span></p></li>
<li><p>“less_than”: <span class="math notranslate nohighlight">\(field &lt;= threshold\)</span></p></li>
<li><p>“adjacent_difference_greater”: <span class="math notranslate nohighlight">\(max( | \text{difference between any nearest-neighbor cell} | ) &gt;= threshold\)</span></p></li>
<li><p>“vorticity”: <span class="math notranslate nohighlight">\(|vorticity| &gt;= 2^{level} * threshold\)</span></p></li>
</ul>
<p>The following example portions of ParmParse’d input files demonstrate the usage of this feature.
This first example tags all cells inside the region ((.25,.25)(.75,.75)):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amr</span><span class="o">.</span><span class="n">refinement_indicators</span> <span class="o">=</span> <span class="n">box</span>

<span class="n">amr</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">in_box_lo</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">.</span><span class="mi">25</span>
<span class="n">amr</span><span class="o">.</span><span class="n">box</span><span class="o">.</span><span class="n">in_box_hi</span> <span class="o">=</span> <span class="o">.</span><span class="mi">75</span> <span class="o">.</span><span class="mi">75</span>
</pre></div>
</div>
<p>The next example adds three user-named criteria –
hi_rho: cells with density greater than 1 on level 0, and greater than 2 on
level 1 and higher;
lo_temp: cells with T less than 450K that are inside the region ((.25,.25)(.75,.75));
and Tdiff: cells having a temperature difference of 20K
or more from that of their
immediate neighbor. The first will trigger up to Amr level 3, the second only to level 1, and the third to level 2.
The third will be active only when the problem time is between 0.001 and 0.002 seconds.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amr</span><span class="o">.</span><span class="n">refinement_indicators</span> <span class="o">=</span> <span class="n">hi_rho</span> <span class="n">lo_temp</span> <span class="n">Tdiff</span>

<span class="n">amr</span><span class="o">.</span><span class="n">high_rho</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">amr</span><span class="o">.</span><span class="n">hi_rho</span><span class="o">.</span><span class="n">value_greater</span> <span class="o">=</span> <span class="mf">1.</span> <span class="mf">2.</span>
<span class="n">amr</span><span class="o">.</span><span class="n">hi_rho</span><span class="o">.</span><span class="n">field_name</span> <span class="o">=</span> <span class="n">density</span>

<span class="n">amr</span><span class="o">.</span><span class="n">lo_temp</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">amr</span><span class="o">.</span><span class="n">lo_temp</span><span class="o">.</span><span class="n">value_less</span> <span class="o">=</span> <span class="mi">450</span>
<span class="n">amr</span><span class="o">.</span><span class="n">lo_temp</span><span class="o">.</span><span class="n">field_name</span> <span class="o">=</span> <span class="n">temp</span>
<span class="n">amr</span><span class="o">.</span><span class="n">lo_temp</span><span class="o">.</span><span class="n">in_box_lo</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">.</span><span class="mi">25</span>
<span class="n">amr</span><span class="o">.</span><span class="n">lo_temp</span><span class="o">.</span><span class="n">in_box_hi</span> <span class="o">=</span> <span class="o">.</span><span class="mi">75</span> <span class="o">.</span><span class="mi">75</span>

<span class="n">amr</span><span class="o">.</span><span class="n">Tdiff</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">amr</span><span class="o">.</span><span class="n">Tdiff</span><span class="o">.</span><span class="n">adjacent_difference_greater</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">amr</span><span class="o">.</span><span class="n">Tdiff</span><span class="o">.</span><span class="n">field_name</span> <span class="o">=</span> <span class="n">temp</span>
<span class="n">amr</span><span class="o">.</span><span class="n">Tdiff</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">amr</span><span class="o">.</span><span class="n">Tdiff</span><span class="o">.</span><span class="n">end_name</span> <span class="o">=</span> <span class="mf">0.002</span>
</pre></div>
</div>
<p>Note that these criteria can be modified between restarts of the code.
By default, the new criteria will take effect at the next
scheduled regrid operation. Alternatively, the user may restart with amr.regrid_on_restart = 1 in order to
do a full (all-levels) regrid after reading the checkpoint data and before advancing any cells.</p>
</section>
<section id="explicitly-defined-tagging-functions">
<h3>Explicitly defined tagging functions<a class="headerlink" href="#explicitly-defined-tagging-functions" title="Permalink to this headline">¶</a></h3>
<p>Explicitly defined error estimation functions can be used either instead of or in addition to
dynmaically generated funtions. These functions can be added to NavierStokes::errorEst() in
NS_error.cpp. Any dynamically generated error functions will operate first.
Please note that while CLEARing a tagged cell is possible, it is not reccomended as it
may not have the desired effect.</p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Parallel.html" class="btn btn-neutral float-right" title="Parallelization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="ManagingGridHierarchy_Chapter.html" class="btn btn-neutral float-left" title="Gridding and Load Balancing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017-2018, IAMR Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>